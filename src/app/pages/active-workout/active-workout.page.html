<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/workouts"></ion-back-button>
    </ion-buttons>
    <ion-title>
      {{ workout?.name || 'Active Workout' }}
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="finishWorkout()">
        <ion-icon name="checkmark-done-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Timer Display -->
  <div class="timer-container">
    <div class="timer-display">{{ formatTime(elapsedTime) }}</div>
    <div class="timer-controls">
      <ion-button *ngIf="workoutActive" (click)="pauseWorkout()" color="warning" class="pause-button">
        PAUSE
      </ion-button>
      <ion-button *ngIf="!workoutActive" (click)="resumeWorkout()" color="success" class="resume-button">
        RESUME
      </ion-button>
    </div>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner></ion-spinner>
    <p>Loading workout...</p>
  </div>

  <!-- Exercise List -->
  <div *ngIf="!isLoading">
    <!-- Empty state when no exercises -->
    <div *ngIf="exercises.length === 0" class="empty-state-container">
      <ion-icon name="barbell-outline"></ion-icon>
      <div class="empty-title">No Exercises Added</div>
      <div class="empty-subtitle">Add exercises to track your workout</div>
      <button class="add-first-exercise-btn" (click)="addExercise()">
        <ion-icon name="add"></ion-icon>
        Add First Exercise
      </button>
    </div>

    <!-- Exercise Cards -->
    <div *ngFor="let exercise of exercises" class="exercise-card">
      <div class="exercise-header">
        <div class="exercise-avatar">
          <img src="assets/exercise-icons/barbell.png" alt="Exercise">
        </div>
        <div class="exercise-title">{{ exercise.name }}</div>
        <div class="exercise-options">
          <ion-button fill="clear" (click)="addSet(exercise)">
            <ion-icon name="add-outline"></ion-icon>
          </ion-button>
        </div>
      </div>

      <!-- Note Section -->
      <div class="notes-section">
        <div class="section-label">Note</div>
        <textarea [(ngModel)]="exercise.notes" placeholder="Add pinned note" class="note-input"></textarea>
      </div>

      <!-- Rest Timer -->
      <div class="timer-section">
        <div class="section-label">Rest Timer: {{ getRestTimeDisplay(exercise.restTimeSeconds || 0) }}</div>
      </div>

      <!-- Sets Section -->
      <div class="sets-section">
        <div class="sets-header">
          <div class="set-col">SET</div>
          <div class="prev-col">PREVIOUS</div>
          <div class="kg-col">KG</div>
          <div class="reps-col">REPS</div>
          <div class="done-col"></div>
        </div>
        
        <div *ngFor="let set of exercise.sets; let setIndex = index" class="set-row" [class.completed-set]="set.completed">
          <div class="set-col">
            <div [class]="'set-type ' + getSetTypeClass(set.type)">
              {{ getSetDisplay(set, exercise.sets || [], setIndex) }}
            </div>
          </div>
          <div class="prev-col">
            {{ getPreviousSetDisplay(exercise, setIndex) }}
          </div>
          <div class="kg-col">
            <span class="weight-value">{{ set.weight || 0 }}</span>
          </div>
          <div class="reps-col">
            <span class="reps-value">{{ set.reps || 0 }}</span>
          </div>
          <div class="done-col">
            <div class="completion-indicator" (click)="toggleSetComplete(exercise, set)">
              <ion-icon [name]="set.completed ? 'checkmark-circle' : 'ellipse-outline'" 
                [class.completed]="set.completed"></ion-icon>
            </div>
          </div>
        </div>
        
        <!-- Add Set Button -->
        <button class="add-set-button" (click)="addSet(exercise)">
          <ion-icon name="add"></ion-icon> Add set
        </button>
      </div>
    </div>

    <!-- Add Exercise Button -->
    <div class="add-exercise-button-container" *ngIf="exercises.length > 0">
      <button class="add-exercise-button" (click)="addExercise()">
        <ion-icon name="add-outline"></ion-icon>
        Add Exercise
      </button>
    </div>
  </div>
</ion-content>